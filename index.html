<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Index</title>
  </head>
  <body>
    <p class="progress"></p>
    <script type="module">
      import Resreq, { Req } from './dist/index.js'

      const resreq = new Resreq({
        baseUrl: ''
      })
      const formData = new FormData()
      formData.append('message', 'no')

      resreq.use((next) => async (req) => {
        console.log(req.credentials)
        debugger
        const formData = new FormData()
        formData.append('message', 'no')
        const _req = new Req(req, {
          Headers: {
            'Content-Type': 'text/plain;charset=UTF-8'
          },
          body: new Uint8Array([111, 107])
        })
        return await next(_req)
      })

      const res = await resreq.post('http://127.0.0.1:8080/', {
        body: formData
      })

      console.log('res', res)
      // const resreq = new Resreq({
      //   base: '/',
      //   // timeout: 4000,
      //   meta: {
      //     test: 1
      //   },
      //   headers: {
      //     'Content-Type': 'application/json'
      //   },
      //   onResponse(progress, chunk) {
      //     console.log('Resreq-progress', progress)
      //     // console.log('chunk', chunk)
      //   }
      // })

      // resreq.use((next) => async (req) => {
      //   try {
      //     // console.log('req2', new Req(req))
      //     console.log('req', req)
      //     debugger
      //     const res = await next(req)
      //     console.log('res', res)
      //     return res
      //   } catch (error) {
      //     console.log('error', error)
      //   }
      // })

      // resreq
      //   .post('http://127.0.0.1:3000', {
      //     body: {
      //       a: 1,
      //       b: 2
      //     },
      //     onResponse({ ratio, carry, total }, chunk) {
      //       document.querySelector('.progress').innerHTML = `Res: ${~~ratio}% ${carry} ${total}`
      //     }
      //   })
      //   .then(async (res) => {
      //     console.log('res', await res.json())
      //   })

      // resreq
      //   .request({
      //     url: 'http://127.0.0.1:3000/static/test.mp4',
      //     method: 'GET',
      //     headers: {
      //       test: 123,
      //       'Content-Type': 'application/json'
      //     },
      //     meta: {
      //       test: 12345
      //     },
      //     onResponse({ ratio, carry, total }, chunk) {
      //       document.querySelector('.progress').innerHTML = `${~~ratio}% ${carry} ${total}`
      //     }
      //   })
      //   .then(async (res) => {
      //     console.log('res', res)

      //     console.log(await res.text())
      //   })
      //   .catch((err) => {
      //     console.log('err', err)
      //   })
    </script>
  </body>
</html>
