<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Index</title>
  </head>
  <body>
    <script type="module">
      import Resreq, { Req } from './dist/index.js'
      const resreq = new Resreq({
        onDownloadProgress(progress, chunk) {
          console.log('Resreq-progress', progress)
          // console.log('chunk', chunk)
        }
      })
      resreq.use((next) => async (req) => {
        try {
          console.log('req', req)
          console.log('next', next)

          console.log(req.headers.get('test'))
          const res = await next(req)
          console.log('res', res)
          return res
        } catch (error) {
          console.log('error', error)
        }
      })
      resreq
        .request({
          url: 'http://127.0.0.1:8080/HandShaker.dmg',
          method: 'GET',
          headers: {
            test: 123,
            'Content-Type': 'application/json'
          },
          meta: {
            test: 12345
          },
          onDownloadProgress(progress, chunk) {
            console.log('request-progress', progress)
            // console.log('chunk', chunk)
          }
        })
        .then(async (res) => {
          console.log('res', await res.text())
        })
        .catch((err) => {
          console.log('err', err)
        })
      // resreq.get('http://www.baidu.com')
      // resreq.post('http://www.baidu.com')
      // resreq.put('http://www.baidu.com')

      // ;(async () => {
      //   try {
      //     const formData = new FormData()
      //     formData.append('test', 'message post')
      //     // const getRes = await yici.get('http://127.0.0.1:3000', {
      //     //   onResponseProgress({ ratio, being, total, speed }, chunk) {
      //     //     const GB = (speed / 1073741824).toFixed(1)
      //     //     const MB = (speed / 1048576).toFixed(1)
      //     //     const KB = (speed / 1024).toFixed(1)

      //     //     const formatRatio = `${~~(ratio * 100)}%`
      //     //     const formatSpeed = GB >= 0.1 ? `${GB}GB/s` : MB >= 0.1 ? `${MB}MB/s` : `${KB}KB/s`
      //     //     document.body.innerText = `response-progress: ${formatRatio} (${being}/${total}) ${formatSpeed}`
      //     //     // console.log(`response-progress: ${formatRatio} (${being}/${total}) ${formatSpeed}`)
      //     //   }
      //     // })
      //     const postRes = await yici.post('http://127.0.0.1:3000/', {
      //       data: formData,
      //       onResponseProgress({ ratio, being, total, speed }, chunk) {
      //         const GB = (speed / 1073741824).toFixed(1)
      //         const MB = (speed / 1048576).toFixed(1)
      //         const KB = (speed / 1024).toFixed(1)

      //         const formatRatio = `${~~(ratio * 100)}%`
      //         const formatSpeed = GB >= 0.1 ? `${GB}GB/s` : MB >= 0.1 ? `${MB}MB/s` : `${KB}KB/s`

      //         console.log(`response-progress: ${formatRatio} (${being}/${total}) ${formatSpeed}`)
      //         debugger
      //       }
      //     })
      //     // console.log('getRes', getRes)
      //     // debugger
      //   } catch (error) {
      //     console.log('ðŸš€ ~ file: index.js ~ line 20 ~ error', error.message)
      //   }
      // })()
    </script>
  </body>
</html>
